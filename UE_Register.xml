<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE scenario SYSTEM "sipp.dtd">

<scenario name="Basic Sipstone UAC">
  <!-- In client mode (sipp placing calls), the Call-ID MUST be         -->
  <!-- generated by sipp. To do so, use [call_id] keyword.     [field0]///[call_id]           -->
   <send>
    <![CDATA[

      INVITE sip:1234567890[call_number]@abc.com SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      Max-Forwards: 70
      Call-ID: caller[call_number]///[call_id]
      Require: not-supported
      From: <sip:[field0]@[field2]>;tag=[pid]UEMO[call_number]
      To: <sip:1234567890[call_number]@abc.com>
      CSeq: 1 INVITE
      P-Preferred-Identity: "Default" <sip:+862161615501@abc.com>
      P-Preferred-Service: urn:urn-7:3gpp-service.exampletelephony.version1
      Contribution-ID: 11111111-f84c-427a-a05f-1f7b6d10d523
      Contribution-ID: 22222222-f84c-427a-a05f-1f7b6d10d523
      Supported: 100rel,eventlist
      User-Agent: SIPP
      Content-Type: application/sdp
      Proxy-Authorization: Digest username="862161615511@abc.com", realm="abc.com", nonce="", uri="sip:abc.com", response=""
      P-Access-Network-Info: 3GPP-E-UTRAN-FDD;utran-cell-id-3gpp=2400784ed4ccca04
      Contact: <sip:[local_ip]:[local_port];transport=[transport]>
      Content-Length: [len]

  v=0
  o=user1 53655765 2353687637 IN IP4 [local_ip]
  s=-
  c=IN IP4 [local_ip]
  t=0 0
  m=audio 6100 RTP/SAVP 8
  a=rtpmap:8 PCMA/8000
  a=crypto:1 AES_CM_256_HMAC_SHA1_80 inline:ihPzQN8NAro6wnkJKryTKadITRi2Ux/zE2/0ZoL2AICspE44XKU09e3+3Dhytw==

    ]]>
    <action>
      <ereg regexp="inline:(.*)" search_in="body" assign_to="310,311"/>
    </action>
  </send>
  <recv response="100" optional="true">
  </recv>

  <recv response="180" optional="true">
  </recv>

  <recv response="200" rrs="true">
    <action>
    <ereg regexp="sip:.*" search_in="hdr" header="Contact:" check_it="true" assign_to="2"/>
     <ereg regexp="<(sip:.*)>.*" header="Contact: " search_in="hdr" assign_to="102,2" />
     <ereg regexp="audio (.*) RTP" search_in="body" assign_to="299,300"/>
     <ereg regexp="inline:([^\r]*)" search_in="body" assign_to="312,313"/>
     <!--   <ereg regexp="c=IN IP4 (.*)" search_in="body" assign_to="301,302"/>  -->
     <log message="[$300]"/>
    </action>
  </recv>

  <Reference variables="102" />
  <Reference variables="299" />
  <Reference variables="310" />
  <Reference variables="312" />

  <send>
    <![CDATA[

      ACK [$2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      [routes]
      [last_From:]
      [last_To:]
      [last_Call-ID:]
      CSeq: 1 ACK
      Contact: <sip:[local_ip]:[local_port];transport=[transport]>
      Max-Forwards: 70
      Content-Length: 0]]>

  </send>

  <nop>
    <action>
	    <exec command="/root/srtp/send_srtp /root/srtp/rtp-rtcp.pcap [local_ip] 6100 [remote_ip] [$300] 256 80 '[$311]' '[$313]'"/>  
    </action>      
  </nop>    

  <pause milliseconds="14000"/> 
   
   <send>
    <![CDATA[

      BYE [$2] SIP/2.0
      Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch]
      [last_From:]
      [last_To:]
      [last_Call-ID:]
      [routes]
      CSeq: 3 BYE
      Max-Forwards: 70
      P-Access-Network-Info: 3GPP-E-UTRAN-FDD;utran-cell-id-3gpp=2400784ed4ccca04
      Content-Length: 0

    ]]>
  </send>

  <recv response="200" crlf="true">
  </recv>


  <!-- definition of the response time repartition table (unit is ms)   -->
  <ResponseTimeRepartition value="10, 20, 30, 40, 50, 100, 150, 200"/>

  <!-- definition of the call length repartition table (unit is ms)     -->
  <CallLengthRepartition value="10, 50, 100, 500, 1000, 5000, 10000"/>

</scenario>

